{"version":3,"file":"index.min.js","sources":["../../src/helpers/movehelpers.js","../../src/helpers/ctxhelpers.js","../../src/errors/error.js","../../src/index.js","../../src/objects/index.js"],"sourcesContent":["export function step(d, v, dirVal, r, dirKey, obj) {\n  // total height = 500\n  if (iscollide(d, v, dirVal, r)) {\n    dirVal = -dirVal;\n    obj[dirKey] = dirVal;\n  }\n  return dirVal * v;\n}\n\n// width = height = 500\nexport function iscollide(d, v, dir, r) {\n  let dd = d + v * dir;\n  return (dd >= (500 - r)) || (dd <= r);\n}\n\n\nexport function mutualcollision(source, target, state = null) {\n  let bb1 = source;\n  let gb1 = target;\n  let dx2 = Math.pow(gb1.gb_x - bb1.bb_x, 2);\n  let dy2 = Math.pow(gb1.gb_y - bb1.bb_y, 2);\n  let d = Math.sqrt(dx2 + dy2);\n  let hp = bb1.hp;\n\n  //detected collision\n  if (d < gb1.gb_r + bb1.bb_r) {\n    hp -= 10;\n  }\n  return hp;\n}","export function create(ctx, x, y, r, color = \"green\") {\n  ctx.beginPath();\n  ctx.arc(x, y, r, 0, Math.PI * 2, false);\n  ctx.fillStyle = color;\n  ctx.fill();\n  ctx.closePath();\n}\n\nexport function clear(ctx) {\n  ctx.clearRect(0, 0, 500, 500);\n}\n\nexport function transaction(ctx, move, ...args) {\n  ctx.restore();\n  /* \n    include all you want\n     create and move\n  */\n  create(ctx, ...args);\n  move();\n  ctx.save();\n}\n","export function xyrError(x, y, r) {\n  if (typeof (x) === \"Number\" && typeof (y) === \"Number\" && typeof (z) === \"Number\")\n    throw new Error(\"Must be Number\");\n  if (x < 0 || y < 0)\n    throw new Error(\"Number must be Positive\");\n  if (x < r || y < r)\n    throw new Error(\"Initial position error\");\n}","import { GB, BB } from \"./objects\";\nimport \"./styles/main.css\";\nimport { clear } from \"./helpers/ctxhelpers\";\nimport { iscollide } from \"./helpers/movehelpers\";\n\nconst canvas = document.getElementById(\"gm5\");\nconst scoreHtml = document.getElementById(\"score\");\nconst ctx = canvas.getContext(\"2d\");\nlet cancelId = null;\n\n\n// record ball position states\n\n\nlet gb1 = new GB(ctx, 100, 50);\nlet gb2 = new GB(ctx, 80, 40);\nlet bb1 = new BB(ctx, 30, 100, 20, \"red\", 300, true);\nlet bb2 = new BB(ctx, 150, 60, 20, \"red\", 200, true);\nlet mybb1 = new BB(ctx, 30, 30, 30, \"yellow\", 100);\n\nlet isRegistered = false;\n//maxVx\n//maxVy\n//define its a(acceleration)\n\n//original a = 0\n//keybinding\nfunction isdiffdir(fdir, selfdir) {\n  return fdir * selfdir < 0;\n}\n\n\n\n\n// f=ma; m=1 ...\n// f=a\nfunction setvx(self, fdir, fx, maxVx) {\n  let dv = fx;\n  console.log(self.vx);\n  // check if collided first\n  if (!isdiffdir(fdir, self.dirx) &&\n    iscollide(self.bb_x, self.vx, self.dirx, self.bb_r)) {\n    self.dirx = -self.dirx;\n    return;\n  }\n  //\n  if (isdiffdir(fdir, self.dirx)) {\n    self.dirx = fdir;\n    if (self.vx - dv >= 0) {\n      self.vx -= dv;\n    }\n    return;\n  }\n  if (self.vx + dv <= maxVx) {\n    self.vx += dv;\n  }\n}\n\nfunction setvy(self, fdir, fy, maxVy) {\n  //let dv = fy * self.vy;\n  let dv = fy;\n\n  if (!isdiffdir(fdir, self.diry) &&\n    iscollide(self.bb_y, self.vy, self.diry, self.bb_r)) {\n    self.diry = -self.diry;\n    return;\n  }\n\n  if (isdiffdir(fdir, self.diry)) {\n    self.diry = fdir;\n    if (self.vy - dv >= 0) {\n      self.vy -= dv;\n    }\n    return;\n  }\n  if (self.vy + dv <= maxVy) {\n    self.vy += dv;\n  }\n}\n\n\nfunction controller(obj) {\n  let self = obj;\n\n  // scalr\n  let fx = 1;\n  let fy = 1;\n  let maxVx = 5;\n  let maxVy = 5;\n  return {\n    left: setvx.bind(self, self, -1, fx, maxVx),\n    right: setvx.bind(self, self, 1, fx, maxVx),\n    up: setvy.bind(self, self, -1, fy, maxVy),\n    down: setvy.bind(self, self, 1, fy, maxVy)\n  }\n}\nconst mybb1controller = controller(mybb1);\n\nfunction register() {\n  //if (!isRegistered) {\n  window.addEventListener(\"keydown\", function (evt) {\n    //console.log(e.keyCode);\n    // when keydown event emit, stepx(), stepy() should change direction\n    // as the keydown arrow key\n    // note: it should follow the boundary rule.\n    switch (evt.keyCode) {\n      case 37:\n        mybb1controller.left();\n        break;\n      case 38:\n        mybb1controller.up();\n        break;\n      case 39:\n        mybb1controller.right();\n        break;\n      case 40:\n        mybb1controller.down();\n        break;\n      // case 32: //SPACE (stop)\n      //   stop();\n      //   break;\n      // case 13: //ENTER (start)\n      //   start();\n      //   break;\n    }\n  }, false);\n\n  //isRegistered = true;\n\n  // stop recover isRegistered false\n  //}\n}\n\n\n\n// let state = {\n//   gb1: { x: gb1.gb_x, y: gb1.gb_y, r: gb1.gb_r },\n//   gb2: { x: gb2.gb_x, y: gb2.gb_y, r: gb2.gb_r },\n//   bb1: { x: bb1.bb_x, y: bb1.bb_y, r: bb1.bb_r, hp: bb1.hp },\n//   mybb1: { x: mybb1.bb_x, y: mybb1.bb_y, r: mybb1.bb_r, hp: mybb1.hp },\n// };\n// function stop(cancelId) {\n//   cancelAnimationFrame(cancelId);\n// }\n\n\n//HP: 100/ Red: 2\n\nfunction start() {\n  clear(ctx);\n  gb1.render(ctx);\n  gb2.render(ctx);\n  bb1.render(ctx, gb1);\n  bb2.render(ctx, gb1);\n  mybb1.render(ctx, null);\n  // bb1.hp > 0 ? bb1.render(ctx, gb1) : null;\n  // bb2.hp > 0 ? bb2.render(ctx, gb1) : null;\n  // mybb1.hp > 0 ? mybb1.render(ctx, null) : null;\n  //let red = 2 - (bb1.hp > 0 ? 0 : 1) - (bb2.hp > 0 ? 0 : 1);\n  //if (red === 0) red += \"\\nDONE! PLEASE REFRESH(F5)\"\n  //scoreHtml.innerHTML = `HP: ${bb1.hp + bb2.hp}/ RED: ${red}`;\n  cancelId = requestAnimationFrame(start);\n}\n\nregister();\nstart();\n\n// when to end?\n// cancelAnimationFrame(cancelId);\n// hp  100 -> 150 => win\n// hp  100 -> 0  => lose","import {\n  step,\n  mutualcollision\n} from \"../helpers/movehelpers\";\nimport {\n  create,\n  clear,\n  transaction\n} from \"../helpers/ctxhelpers\";\nimport { xyrError } from \"../errors/error\";\n\n// gb - good ball\nclass GB {\n  constructor(ctx, x = 240, y = 160, r = 10, hp = 100) {\n    xyrError(x, y, r);\n    this.gb_x = x;\n    this.gb_y = y;\n    this.gb_r = r;\n    this.vx = 3;\n    this.vy = 3;\n    this.dirx = 1;\n    this.diry = 1;\n    this.hp = hp;\n    create(ctx, this.gb_x, this.gb_y, this.gb_r);\n  }\n  move() {\n    this.gb_x += step(this.gb_x, this.vx, this.dirx, this.gb_r, \"dirx\", this);\n    this.gb_y += step(this.gb_y, this.vy, this.diry, this.gb_r, \"diry\", this);\n  }\n  render(ctx) {\n    transaction(ctx, this.move.bind(this), this.gb_x, this.gb_y, this.gb_r);\n  }\n}\n\n// mp - magic power\n\n// bb - bad ball\nclass BB {\n  constructor(\n    ctx,\n    x = 240,\n    y = 160,\n    r = 10,\n    color = \"red\",\n    hp = 100,\n    detected = false\n  ) {\n    xyrError(x, y, r);\n    this.bb_x = x;\n    this.bb_y = y;\n    this.bb_r = r;\n    this.dirx = -1;\n    this.diry = 1;\n    this.vx = 1;\n    this.vy = 1;\n    this.color = color;\n    this.hp = hp;\n    this.detected = detected;\n    create(ctx, this.bb_x, this.bb_y, this.bb_r, this.color);\n  }\n\n  move() {\n    this.bb_x += step(this.bb_x, this.vx, this.dirx, this.bb_r, \"dirx\", this);\n    this.bb_y += step(this.bb_y, this.vy, this.diry, this.bb_r, \"diry\", this);\n  }\n  render(ctx, target = null) {\n    transaction(\n      ctx,\n      this.move.bind(this),\n      this.bb_x,\n      this.bb_y,\n      this.bb_r,\n      this.color\n    );\n    this.collision(this, target);\n  }\n  collision(source, target) {\n    if (this.detected && target !== null) {\n      this.hp = mutualcollision(source, target);\n    }\n  }\n}\n\n\n\nexport { GB, BB };\n"],"names":["step","d","v","dirVal","r","dirKey","obj","iscollide","dir","dd","create","ctx","x","y","color","beginPath","arc","Math","PI","fillStyle","fill","closePath","transaction","move","restore","args","save","xyrError","z","Error","isdiffdir","fdir","selfdir","setvx","self","fx","maxVx","dv","log","vx","dirx","bb_x","bb_r","setvy","fy","maxVy","diry","bb_y","vy","start","clearRect","render","gb1","requestAnimationFrame","GB","hp","gb_x","gb_y","gb_r","this","bind","BB","detected","target","collision","source","bb1","dx2","pow","dy2","sqrt","mutualcollision","document","getElementById","canvas","getContext","cancelId","gb2","bb2","mybb1","mybb1controller","controller","addEventListener","evt","keyCode","left","up","right","down"],"mappings":"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"}